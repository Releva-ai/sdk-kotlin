steps:
  # Install Android SDK, run tests, and build
  - id: build-and-test
    name: gradle:8.9-jdk17
    entrypoint: sh
    args:
      - -c
      - |
        echo "=== Installing Android SDK ==="
        apt-get update -qq
        apt-get install -y wget unzip
        mkdir -p /opt/android-sdk/cmdline-tools
        cd /opt/android-sdk/cmdline-tools
        wget -q https://dl.google.com/android/repository/commandlinetools-linux-11076708_latest.zip
        unzip -q commandlinetools-linux-11076708_latest.zip
        mv cmdline-tools latest

        export ANDROID_HOME=/opt/android-sdk
        export PATH=$$PATH:$$ANDROID_HOME/cmdline-tools/latest/bin:$$ANDROID_HOME/platform-tools

        echo "=== Accepting SDK licenses ==="
        yes | sdkmanager --licenses || true

        echo "=== Installing SDK components ==="
        sdkmanager "platform-tools" "platforms;android-35" "build-tools;35.0.0"

        echo "Android SDK installed at $$ANDROID_HOME"

        cd /workspace

        echo "=== Running tests ==="
        ./gradlew :releva-sdk:test

        echo "=== Building SDK ==="
        ./gradlew :releva-sdk:build

        echo "=== Build and test completed successfully ==="

options:
  defaultLogsBucketBehavior: REGIONAL_USER_OWNED_BUCKET
  machineType: 'E2_HIGHCPU_8'

timeout: '1200s'
